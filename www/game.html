<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <meta id="viewport" name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=yes, target-densitydpi=device-dpi">

  <title>WasWarWannWo</title>

  <link rel="stylesheet" type="text/css" href="css/third_party/leaflet.css" />
  <link rel="stylesheet" type="text/css" href="css/third_party/font-awesome.min.css" />
  <link rel="stylesheet" type="text/css" href="css/wwww.min.css" />

  <script type="text/javascript" src="js/third-party/jquery-1.10.2.js"></script>
  <script type="text/javascript" src="js/third-party/jquery-ui-1.10.4.min.js"></script>
  <script type="text/javascript" src="js/third-party/jquery.ui.touch-punch.min.js"></script>
  <script type="text/javascript" src="js/third-party/jquery.csv-0.71.min.js"></script>
  <script type="text/javascript" src="js/third-party/jquery.mousewheel.min.js"></script>
  <script type="text/javascript" src="js/third-party/leaflet.js"></script>
  <script type="text/javascript" src="js/third-party/playfab.js"></script>

  <script type="text/javascript" src="js/wwww.min.js"></script>

  <script type="text/javascript">

    var ww = $(window).width()
    var wh = $(window).height()
    var mw = 500; // min width of site
    var mh = 800; // min height of site
    var w_ratio =  ww / mw;
    var h_ratio =  wh / mh;

    var r = Math.min(w_ratio, h_ratio);

    $('#viewport').attr('content', 'initial-scale='+r+', maximum-scale='+r+', minimum-scale='+r+', user-scalable=yes, target-densitydpi=device-dpi');

    var userMail = "";

    function updateCookies() {
      WWWW.setCookie("wwww-session-ticket", exports.settings.session_ticket, 1);
      WWWW.setCookie("wwww-user-mail", userMail, 10);
    }

    window.fbAsyncInit = function() {
      FB.init({
        appId      : '264225387098292',
        cookie     : true,  // enable cookies to allow the server to access
                            // the session
        xfbml      : true,  // parse social plugins on this page
        version    : 'v2.2' // use version 2.2
      });
    }

    $(document).ready(function($) {

      $("#feedback-fail").hide()

      // var mobileKeyboardHandler = new WWWW.MobileKeyboardHandler();
      var theapp = new WWWW.QuestionHandler();

      var registerEmail = false;

      var cached_ticket = WWWW.getCookie("wwww-session-ticket");
      userMail = WWWW.getCookie("wwww-user-mail")

      $("#login-dialog-email-text").val(userMail)

      if (cached_ticket != "") {
        exports.settings.session_ticket = cached_ticket;
        $("#login-button-email").addClass("success");
        $("#login-email-state").html("mit Email eingeloggt");
      }

      $("#login-dialog-email").hide();
      $("#login-dialog-email-username").hide();
      $("#login-dialog-email-password-repeat").hide();
      $("#login-button-email").click(function() {
        $("#login-dialog-email").toggle();
      });

      $("#login-email-submit").click(function() {
        userMail = $("#login-dialog-email-text").val();
        var pwd  = $("#login-dialog-email-password").val();

        var request = {
          "Email": userMail,
          "Password": pwd
        };

        exports.client.LoginWithEmailAddress(request,
          function(error, result) {
            console.log("Logging in with mail")
            console.log("Error:", error);
            console.log("Response:", result);

            if (result) {

              $("#login-email-state").html("mit Email eingeloggt");
              $("#login-dialog-email").toggle();
              $("#login-button-email").addClass("success");

              updateCookies();
            }
          }
        );
      });

      $("#login-email-register").click(function() {
        if (!registerEmail) {
          $("#login-dialog-email-username").show();
          $("#login-dialog-email-password-repeat").show();
          $("#login-email-register").text("Registrieren");
          $("#login-email-submit").hide();
          registerEmail = true;
        } else {
          var user    = $("#login-dialog-email-username-text").val();
          userMail    = $("#login-dialog-email-text").val();
          var pwd     = $("#login-dialog-email-password").val();
          var pwdRep  = $("#login-dialog-email-password-repeat-text").val();

          if (pwd == pwdRep) {

            var request = {
              "Username" : user,
              "Email": userMail,
              "Password": pwd
            };

            exports.client.RegisterPlayFabUser(request,
              function(error, result) {
                console.log("Registering mail user")
                console.log("Error:", error);
                console.log("Response:", result);

                if (result) {
                  $("#login-email-state").html("mit Email eingeloggt");
                  $("#login-dialog-email").toggle();
                  $("#login-button-email").addClass("success");

                  updateCookies();
                }
              }
            );
          }
        }
      });

      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));

      $("#login-button-fb").click(function() {
        FB.login(function(response){
          if (response.status == "connected") {
            var request = {
              "AccessToken": response.authResponse.accessToken,
              "CreateAccount" : true
            }

            exports.client.LoginWithFacebook(request,
              function(error, result) {
                console.log("Registering mail user")
                console.log("Error:", error);
                console.log("Response:", result);

                if (result) {
                  $("#login-fb-state").html("mit Facebook eingeloggt");
                  $("#login-button-fb").addClass("success");

                  updateCookies();
                }
              }
            );
          }
        });
      });

      $("#start-button").click(function() {
        $("#title-screen").fadeOut();

        theapp.run();

        $("#question-progress").css({width:'100%'});
      });

    });
  </script>
</head>
<body>

      <div id="question-screen">

        <div class="map-area">
          <div class="map" id="map"></div>
          <div id="map-marker">
            <div class="pd-container">
              <div class="pd-pulse"></div>
              <div class="pd-dot"></div>
            </div>
          </div>
          <!-- <div id="map-zoom-control">
            <img id="map-zoom-plus" class="zoom-button" src="img/plus.svg"></img>
            <div id="map-zoom-slider">
              <div id="map-zoom-line"></div>
              <div id="map-zoom-handle-outer">
                <div id="map-zoom-handle-inner"></div>
              </div>
            </div>
            <img id="map-zoom-minus" class="zoom-button" src="img/minus.svg"></img>
          </div> -->
          <div id="submit-answer-outer"><div id="submit-answer" class="link btn primary"><img src="img/check.svg" /></div></div>
          <div id="results" class="text-center hidden">
            <div id="answer"><span id="answer-location"></span>, <span id="answer-year"></span>. <span id="answer-info"></span></div>
            <div id="score">
              <div id="answer-total-score"></div>
              <div id="answer-error">Distanz: <span id="answer-spatial-distance"></span> / <span id="answer-temporal-distance"></span></div>
              <div id="answer-previous-score"></div>
              <div id="next-question" class="link btn primary"><img src="img/arrow-right.svg" /></div>
              <div id="abort" class="link"><img src="img/cross.svg" /></div>
            </div>
          </div>
          <div id="top-bar">
            <div id="question-bar">
              <div id="question"></div>
            </div>
            <div class="question-progress-background" style="height:9px">
              <div id="question-progress" class="question-progress animate"></div>
            </div>
            <div class="timeline" id="timeline">
              <div id="tl-year-container">
                <div id="tl-chosen" class="tl-year-box tl-year-box center">
                  <div id="tl-chosen-text" class="tl-year-box-text">gewähltes Jahr</div>
                  <div class="tl-year-box-year"><span id="tl-chosen-year">1900</span></div>
                </div>
                <div id="tl-correct" class="tl-year-box tl-year-box">
                  <div id="tl-correct-text" class="tl-year-box-text">korrektes Jahr</div>
                  <div class="tl-year-box-year"><span id="tl-correct-year">1800</div></div>
                </div>
              </div>
              <div id="tl-zoom-control">
                <img id="tl-zoom-minus" class="zoom-button" src="img/minus.svg"></img>
                <div id="tl-zoom-slider">
                  <div id="tl-zoom-line"></div>
                  <div id="tl-zoom-handle-outer" class="tl-zoom-handle-outer">
                    <div id="tl-zoom-handle-inner" class="pd-container">
                      <div class="pd-pulse"></div>
                      <div class="pd-dot"></div>
                    </div>
                  </div>
                  <div id="tl-zoom-handle-outer-answer" class="tl-zoom-handle-outer">
                    <img src="img/marker_result.png" width="20px"></img>
                  </div>
                  <div id="tl-zoom-handle-outer-result" class="tl-zoom-handle-outer">
                    <img src="img/marker.png" width="20px"></img>
                  </div>
                </div>
                <img id="tl-zoom-plus" class="zoom-button" src="img/plus.svg"></img>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="title-screen">
        <div class="text-center">
          <img id="logo" src="img/logo.svg" />
        </div>
        <div class="text-center">
          <p>
            <div class="btn block" id="login-button-email" href="#">
              <img src="img/googleplus.svg">
              <span id="login-email-state">mit Email einloggen</span>
            </div>
            <div id="login-dialog-email" class="login-dialog">
              <table>
                <tr id="login-dialog-email-username">
                  <td> Nutzername: </td>
                  <td> <input id="login-dialog-email-username-text" type="text" autocomplete="on"></input></td>
                </tr>
                <tr>
                  <td>Email:</td>
                  <td><input id="login-dialog-email-text" type="email" autocomplete="on"></input></td>
                </tr>
                <tr>
                  <td> Passwort: </td>
                  <td> <input id="login-dialog-email-password" type="password"></input></td>
                </tr>
                <tr id="login-dialog-email-password-repeat">
                  <td> Passwort bestätigen: </td>
                  <td> <input id="login-dialog-email-password-repeat-text" type="password"></input> </td>
                </tr>
              </table>
              <p><div class="btn block" id="login-email-submit"><span>Einloggen</span></div></p>
              <p><div class="btn block" id="login-email-register"><span>Neu anmelden</span></div></p>
            </div>
          </p>
          <p><div class="btn block"><img src="img/googleplus.svg"> <span>mit Google+ einloggen</span></div></p>
          <p>
            <div class="btn block" id="login-button-fb">
              <img src="img/facebook.svg">
              <span id="login-fb-state">mit Facebook einloggen</span>
            </div>
          </p>
          <br>
          <p><div id="start-button" class="btn block primary">Spiel starten</div></p>
        </div>
        <div id="histoglobe" class="text-center">
          <img src="img/histoglobe.png" />
        </div>
        <div id="feedback-fail" class="feedback-start-fail"> WWWW läuft leider noch nicht auf deiner Plattform! Probiere es an deinem Rechner.</div>
        <div id="version"></div>
      </div>


</body>

</html>
